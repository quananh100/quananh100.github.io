<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <title>Nh·∫∑t b√≥ng v√†o 2 r·ªï</title>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      overflow: hidden;
      background-color: #000;
    }
    canvas {
      display: block;
      background-color: #fff;
    }
    #ui {
      position: fixed;
      top: 10px;
      left: 10px;
      z-index: 10;
      color: white;
      font-size: 20px;
      font-family: sans-serif;
    }
    #buttons {
      position: fixed;
      bottom: 10px;
      right: 10px;
      z-index: 10;
    }
    .icon-btn {
      background: none;
      border: none;
      cursor: pointer;
      margin-left: 10px;
    }
    .icon-btn img {
      width: 40px;
      height: 40px;
    }
  </style>
</head>
<body>
  <div id="ui">‚è±Ô∏è Th·ªùi gian: <span id="timer">120</span> | üéØ ƒêi·ªÉm: <span id="score">0</span></div>
  <div id="buttons">
    <button class="icon-btn" id="pauseBtn" title="D·ª´ng">‚è∏Ô∏è</button>
    <button class="icon-btn" id="resetBtn" title="Ch∆°i l·∫°i">
      <img src="https://img.icons8.com/ios-filled/50/ffffff/restart--v1.png" alt="Reset" />
    </button>
  </div>
  <canvas id="gameCanvas"></canvas>
  <script>
    const canvas = document.getElementById("gameCanvas");
    const ctx = canvas.getContext("2d");
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;

    let basket = { x: canvas.width / 2 - 50, y: 50, width: 100, height: 20 };
    let basket2 = { x: canvas.width / 2 + 100, y: 50, width: 100, height: 20 };
    let bot = { x: 100, width: 100, height: 20 };

    let balls = [];
    const ballCount = 5;
    const ballRadius = 10;
    for (let i = 0; i < ballCount; i++) {
      balls.push({ x: Math.random() * canvas.width, y: -i * 100, radius: ballRadius, speed: 3 });
    }

    let score = 0;
    let timeLeft = 120;
    let isPaused = false;
    let timerInterval;

    const keys = {};
    document.addEventListener("keydown", e => keys[e.key] = true);
    document.addEventListener("keyup", e => keys[e.key] = false);

    function resetGame() {
      score = 0;
      timeLeft = 120;
      for (let i = 0; i < ballCount; i++) {
        balls[i].x = Math.random() * canvas.width;
        balls[i].y = -i * 100;
      }
      startTimer();
      loop();
    }

    function startTimer() {
      clearInterval(timerInterval);
      timerInterval = setInterval(() => {
        if (!isPaused) {
          timeLeft--;
          document.getElementById("timer").textContent = timeLeft;
          if (timeLeft <= 0) {
            clearInterval(timerInterval);
            alert("‚è∞ H·∫øt gi·ªù! B·∫°n ghi ƒë∆∞·ª£c " + score + " ƒëi·ªÉm!");
          }
        }
      }, 1000);
    }

    function loop() {
      if (isPaused) return;
      update();
      draw();
      requestAnimationFrame(loop);
    }

    function update() {
      if (keys["ArrowLeft"]) bot.x -= 5;
      if (keys["ArrowRight"]) bot.x += 5;
      bot.x = Math.max(0, Math.min(canvas.width - bot.width, bot.x));

      // bot AI auto theo b√≥ng g·∫ßn nh·∫•t
      let targetBall = balls.reduce((a, b) => (a.y > b.y ? a : b));
      if (targetBall.x < basket.x + basket.width / 2) basket.x -= 4;
      if (targetBall.x > basket.x + basket.width / 2) basket.x += 4;
      basket.x = Math.max(0, Math.min(canvas.width - basket.width, basket.x));

      basket2.x = basket.x + 200;

      for (let ball of balls) {
        ball.y += ball.speed;
        if (checkCatch(ball, basket) || checkCatch(ball, basket2)) {
          score++;
          document.getElementById("score").textContent = score;
          resetBall(ball);
        } else if (checkCatch(ball, { x: bot.x, y: canvas.height - 40, width: bot.width, height: bot.height })) {
          resetBall(ball);
        } else if (ball.y > canvas.height) {
          resetBall(ball);
        }
      }
    }

    function resetBall(ball) {
      ball.x = Math.random() * (canvas.width - 2 * ballRadius) + ballRadius;
      ball.y = -Math.random() * 200;
    }

    function checkCatch(ball, box) {
      return (
        ball.y + ball.radius >= box.y &&
        ball.y - ball.radius <= box.y + box.height &&
        ball.x >= box.x &&
        ball.x <= box.x + box.width
      );
    }

    function draw() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);

      // r·ªï AI
      ctx.fillStyle = "blue";
      ctx.fillRect(basket.x, basket.y, basket.width, basket.height);
      ctx.fillRect(basket2.x, basket2.y, basket2.width, basket2.height);

      // bot ng∆∞·ªùi ch∆°i
      ctx.fillStyle = "green";
      ctx.fillRect(bot.x, canvas.height - 40, bot.width, bot.height);

      // b√≥ng
      for (let ball of balls) {
        ctx.beginPath();
        ctx.arc(ball.x, ball.y, ball.radius, 0, Math.PI * 2);
        ctx.fillStyle = "red";
        ctx.fill();
        ctx.closePath();
      }
    }

    document.getElementById("pauseBtn").onclick = () => {
      isPaused = !isPaused;
      if (!isPaused) loop();
    };

    document.getElementById("resetBtn").onclick = () => {
      location.reload();
    };

    window.onload = () => {
      startTimer();
      loop();
    };
  </script>
</body>
</html>
